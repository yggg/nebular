(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{SM1g:function(t,e,n){"use strict";n.r(e),n.d(e,"filterInterceptorRequest",function(){return ot}),n.d(e,"AuthPlaygroundModule",function(){return it});var r=n("ofXK"),o=n("3Pt+"),i=n("tk/3"),c=n("0AKQ"),a=n("F4EV"),s=n("n81q"),u=n("eIep"),l=n("BDhN"),p=n("0ICW"),b=n("fXoL"),h=function(){function t(t,e){this.injector=t,this.filter=e}return t.prototype.intercept=function(t,e){var n=this;return this.filter(t)?e.handle(t):this.authService.isAuthenticatedOrRefresh().pipe(Object(u.a)(function(r){return r?n.authService.getToken().pipe(Object(u.a)(function(n){var r="Bearer "+n.getValue();return t=t.clone({setHeaders:{Authorization:r}}),e.handle(t)})):e.handle(t)}))},Object.defineProperty(t.prototype,"authService",{get:function(){return this.injector.get(l.a)},enumerable:!1,configurable:!0}),t.\u0275fac=function(e){return new(e||t)(b.dc(b.s),b.dc(p.e))},t.\u0275prov=b.Mb({token:t,factory:t.\u0275fac}),t}(),f=n("Abgx"),d=n("6y2k"),g=n("++eV"),y=n("4pP6"),v=n("X/Iy"),m=n("89WS"),w=function(){return function(){}}(),k=new b.r("Nebular Security Options"),R=function(t){return Object.assign({},t)},V=function(t){return Object.assign([],t)},O=function(t){var e=t.parent;return delete t.parent,e},C=function(){function t(t){void 0===t&&(t={}),this.settings=t,this.state={},t.accessControl&&this.setAccessControl(t.accessControl)}return t.prototype.setAccessControl=function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e],o=r[0],i=R(r[1]),c=O(i);this.register(o,c,i)}},t.prototype.register=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n={}),this.validateRole(t),this.state[t]={parent:e};for(var r=0,o=Object.entries(n);r<o.length;r++){var i=o[r],c=i[1];this.allow(t,i[0],V("string"==typeof c?[c]:c))}},t.prototype.allow=function(t,e,n){this.validateRole(t),this.getRole(t)||this.register(t,null,{}),n="string"==typeof n?[n]:n;var r=V(this.getRoleResources(t,e));r=r.concat(n),this.state[t][e]=r.filter(function(t,e){return r.indexOf(t)===e})},t.prototype.can=function(t,e,n){return this.validateResource(n),this.getRoleParent(t)&&this.can(this.getRoleParent(t),e,n)||this.exactCan(t,e,n)},t.prototype.getRole=function(t){return this.state[t]},t.prototype.validateRole=function(t){if(!t)throw new Error("NbAclService: role name cannot be empty")},t.prototype.validateResource=function(e){if(!e||[t.ANY_RESOURCE].includes(e))throw new Error("NbAclService: cannot use empty or bulk '*' resource placeholder with 'can' method")},t.prototype.exactCan=function(e,n,r){var o=this.getRoleResources(e,n);return o.includes(r)||o.includes(t.ANY_RESOURCE)},t.prototype.getRoleResources=function(t,e){return this.getRoleAbilities(t)[e]||[]},t.prototype.getRoleAbilities=function(t){var e=R(this.state[t]||{});return O(R(this.state[t]||{})),e},t.prototype.getRoleParent=function(t){return this.state[t]?this.state[t].parent:null},t.ANY_RESOURCE="*",t.\u0275fac=function(e){return new(e||t)(b.dc(k,8))},t.\u0275prov=b.Mb({token:t,factory:t.\u0275fac}),t}(),S=n("lJxs"),W=function(){function t(t,e){this.roleProvider=t,this.acl=e}return t.prototype.isGranted=function(t,e){var n=this;return this.roleProvider.getRole().pipe(Object(S.a)(function(t){return Array.isArray(t)?t:[t]}),Object(S.a)(function(r){return r.some(function(r){return n.acl.can(r,t,e)})}))},t.\u0275fac=function(e){return new(e||t)(b.dc(w),b.dc(C))},t.\u0275prov=b.Mb({token:t,factory:t.\u0275fac}),t}(),A=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:k,useValue:e},C,W]}},t.\u0275mod=b.Ob({type:t}),t.\u0275inj=b.Nb({factory:function(e){return new(e||t)},imports:[[r.c]]}),t}(),j=n("tyNb"),I=function(){function t(){}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Kb({type:t,selectors:[["nb-playground-auth"]],decls:1,vars:0,template:function(t,e){1&t&&b.Rb(0,"router-outlet")},directives:[j.h],encapsulation:2}),t}(),P=n("2Az5"),E=n("DYSn"),K=n("9S34"),D=n("9XlZ"),N=n("Lu/0"),G=n("8qs0"),q=n("vuB0"),M=n("S+eJ"),Q=n("1G5W"),T=n("XNiG"),$=function(){function t(t,e,n){this.templateRef=t,this.viewContainer=e,this.accessChecker=n,this.destroy$=new T.a,this.hasView=!1}return Object.defineProperty(t.prototype,"nbIsGranted",{set:function(t){var e=this;this.accessChecker.isGranted(t[0],t[1]).pipe(Object(Q.a)(this.destroy$)).subscribe(function(t){t&&!e.hasView?(e.viewContainer.createEmbeddedView(e.templateRef),e.hasView=!0):!t&&e.hasView&&(e.viewContainer.clear(),e.hasView=!1)})},enumerable:!1,configurable:!0}),t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},t.\u0275fac=function(e){return new(e||t)(b.Qb(b.N),b.Qb(b.S),b.Qb(W))},t.\u0275dir=b.Lb({type:t,selectors:[["","nbIsGranted",""]],inputs:{nbIsGranted:"nbIsGranted"}}),t}();function _(t,e){1&t&&(b.Wb(0,"button"),b.Kc(1,"Post Comment"),b.Vb())}function x(t,e){1&t&&(b.Wb(0,"button"),b.Kc(1,"Post Comment"),b.Vb())}var F=function(){return["create","comments"]},X=function(){function t(t){this.accessChecker=t}return t.\u0275fac=function(e){return new(e||t)(b.Qb(W))},t.\u0275cmp=b.Kb({type:t,selectors:[["nb-actions-test"]],decls:13,vars:5,consts:[[4,"ngIf"],[4,"nbIsGranted"]],template:function(t,e){1&t&&(b.Wb(0,"nb-layout"),b.Wb(1,"nb-layout-column"),b.Wb(2,"nb-card"),b.Wb(3,"nb-card-header"),b.Kc(4,"Service usage"),b.Vb(),b.Wb(5,"nb-card-body"),b.Ic(6,_,2,0,"button",0),b.lc(7,"async"),b.Vb(),b.Vb(),b.Wb(8,"nb-card"),b.Wb(9,"nb-card-header"),b.Kc(10,"Directive usage"),b.Vb(),b.Wb(11,"nb-card-body"),b.Ic(12,x,2,0,"button",1),b.Vb(),b.Vb(),b.Vb(),b.Vb()),2&t&&(b.Db(6),b.qc("ngIf",b.mc(7,2,e.accessChecker.isGranted("create","comments"))),b.Db(6),b.qc("nbIsGranted",b.tc(4,F)))},directives:[q.b,q.a,M.b,M.d,M.a,r.o,$],pipes:[r.b],encapsulation:2}),t}(),Y=n("vkgz"),J=function(){function t(t,e){this.authService=t,this.router=e}return t.prototype.canActivate=function(){var t=this;return this.authService.isAuthenticated().pipe(Object(Y.a)(function(e){e||t.router.navigate(["auth/login"])}))},t.\u0275fac=function(e){return new(e||t)(b.dc(l.a),b.dc(j.c))},t.\u0275prov=b.Mb({token:t,factory:t.\u0275fac}),t}(),L=n("LRne"),B=n("3E0/"),z=n("JIr8"),H=n("iVvT"),U=n("jXul");function Z(t,e){if(1&t&&(b.Wb(0,"nb-list-item"),b.Kc(1),b.Vb()),2&t){var n=e.$implicit;b.Db(1),b.Oc(" ",n.region,", ",n.name," (",n.year,") ")}}function tt(t,e){if(1&t&&(b.Wb(0,"nb-card"),b.Wb(1,"nb-card-header"),b.Kc(2," Alain'wines "),b.Vb(),b.Wb(3,"nb-list"),b.Ic(4,Z,2,3,"nb-list-item",2),b.lc(5,"async"),b.Vb(),b.Vb()),2&t){var n=b.kc();b.Db(4),b.qc("ngForOf",b.mc(5,1,n.wines$))}}var et=[{path:"",component:I,children:[{path:"",component:P.a,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:E.a},{path:"register",component:K.a},{path:"logout",component:D.a},{path:"request-password",component:N.a},{path:"reset-password",component:G.a}]}]},{path:"acl/acl-test.component",component:X},{path:"auth-guard.service",canActivate:[J],component:I},{path:"api-calls.component",canActivate:[J],component:function(){function t(t,e,n,r){var o=this;void 0===r&&(r={}),this.authService=t,this.http=e,this.router=n,this.options=r,this.redirectDelay=0,this.strategy="",this.redirectDelay=this.getConfigValue("forms.logout.redirectDelay"),this.strategy=this.getConfigValue("forms.logout.strategy"),this.authService.onTokenChange().subscribe(function(t){o.token=null,t&&t.isValid()&&(o.token=t)})}return t.prototype.logout=function(){var t=this;this.authService.logout(this.strategy).pipe(Object(B.a)(this.redirectDelay)).subscribe(function(e){return t.router.navigate(["/auth/login"])})},t.prototype.loadWines=function(){var t=this;this.wines$=this.http.get("http://localhost:4400/api/wines").pipe(Object(z.a)(function(e){return e instanceof i.d&&401===e.status&&t.router.navigate(["/auth/login"]),Object(L.a)([])}))},t.prototype.getConfigValue=function(t){return Object(H.b)(this.options,t,null)},t.\u0275fac=function(e){return new(e||t)(b.Qb(l.a),b.Qb(i.b),b.Qb(j.c),b.Qb(p.b))},t.\u0275cmp=b.Kb({type:t,selectors:[["nb-playground-api-calls"]],decls:15,vars:3,consts:[["nbButton","","status","primary",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,e){var n;1&t&&(b.Rb(0,"router-outlet"),b.Wb(1,"nb-layout"),b.Wb(2,"nb-layout-column"),b.Wb(3,"nb-card"),b.Wb(4,"nb-card-body"),b.Wb(5,"h2"),b.Kc(6,"You are authenticated"),b.Vb(),b.Wb(7,"p"),b.Kc(8,"You can call the secured API"),b.Vb(),b.Wb(9,"button",0),b.gc("click",function(){return e.loadWines()}),b.Kc(10,"Call API"),b.Vb(),b.Wb(11,"button",0),b.gc("click",function(){return e.logout()}),b.Kc(12,"Sign out"),b.Vb(),b.Vb(),b.Vb(),b.Ic(13,tt,6,3,"nb-card",1),b.lc(14,"async"),b.Vb(),b.Vb()),2&t&&(b.Db(13),b.qc("ngIf",null==(n=b.mc(14,1,e.wines$))?null:n.length))},directives:[j.h,q.b,q.a,M.b,M.a,r.o,M.d,U.a,r.n,U.b],pipes:[r.b],encapsulation:2}),t}()}],nt=function(){function t(){}return t.\u0275mod=b.Ob({type:t}),t.\u0275inj=b.Nb({factory:function(e){return new(e||t)},imports:[[j.g.forChild(et)],j.g]}),t}(),rt=function(){function t(t){this.authService=t}return t.prototype.getRole=function(){return this.authService.onTokenChange().pipe(Object(S.a)(function(t){return t instanceof y.b&&t.isValid()?t.getPayload().role:"guest"}))},t.\u0275fac=function(e){return new(e||t)(b.dc(l.a))},t.\u0275prov=b.Mb({token:t,factory:t.\u0275fac}),t}();function ot(t){return["http://localhost:4400/api/auth/","http://other.url/with/no/token/injected/"].some(function(e){return t.url.includes(e)})}var it=function(){function t(){}return t.\u0275mod=b.Ob({type:t}),t.\u0275inj=b.Nb({factory:function(e){return new(e||t)},providers:[J,{provide:i.a,useClass:h,multi:!0},{provide:p.e,useValue:ot},{provide:w,useClass:rt}],imports:[[r.c,o.g,i.c,nt,c.a,a.a,s.a,f.a.forRoot({forms:{login:{strategy:"password",redirectDelay:1e3,socialLinks:[{url:"https://github.com/akveo",target:"_blank",title:"GitHub"},{url:"https://www.facebook.com/akveo",target:"_blank",icon:"home-outline"},{url:"https://www.facebook.com/akveo",target:"_blank",title:"Twitter"}]}},strategies:[d.a.setup({name:"dummy",alwaysFail:!0,delay:1e3}),g.a.setup({name:"email",token:{class:y.b},baseEndpoint:"http://localhost:4400/api/auth/",logout:{redirect:{success:"/auth/login",failure:"/auth/login"}},requestPass:{redirect:{success:"/auth/reset-password"}},resetPass:{redirect:{success:"/auth/login"}},errors:{key:"data.errors"}}),v.a.setup({name:"password",clientId:"test",clientSecret:"secret",baseEndpoint:"http://localhost:4400/api/auth/",token:{endpoint:"token",grantType:m.b.PASSWORD,class:y.d},refresh:{endpoint:"refresh-token",grantType:m.b.REFRESH_TOKEN}})]}),A.forRoot({accessControl:{guest:{view:["news","comments"]},user:{parent:"guest",create:"comments"},moderator:{parent:"user",create:"news",remove:"*"}}})]]}),t}()}}]);