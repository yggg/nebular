(self.webpackChunknebular=self.webpackChunknebular||[]).push([[5230],{65230:function(t,e,n){"use strict";n.r(e),n.d(e,{AuthPlaygroundModule:function(){return it},filterInterceptorRequest:function(){return ot}});var r=n(61116),o=n(31041),i=n(42693),s=n(55074),c=n(38851),a=n(54014),u=n(44689),l=n(98880),p=n(17295),h=n(11785),f=function(){function t(t,e){this.injector=t,this.filter=e}return t.prototype.intercept=function(t,e){var n=this;return this.filter(t)?e.handle(t):this.authService.isAuthenticatedOrRefresh().pipe((0,u.w)(function(r){return r?n.authService.getToken().pipe((0,u.w)(function(n){var r="Bearer "+n.getValue();return t=t.clone({setHeaders:{Authorization:r}}),e.handle(t)})):e.handle(t)}))},Object.defineProperty(t.prototype,"authService",{get:function(){return this.injector.get(l._)},enumerable:!1,configurable:!0}),t.\u0275fac=function(e){return new(e||t)(h.LFG(h.zs3),h.LFG(p.nN))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t}(),d=n(40747),g=n(48153),v=n(93857),y=n(72994),b=n(36325),m=n(9910),w=function(){return function(){}}(),A=new h.OlP("Nebular Security Options"),Z=function(t){return Object.assign({},t)},R=function(t){return Object.assign([],t)},k=function(t){var e=t.parent;return delete t.parent,e},C=function(){function t(t){void 0===t&&(t={}),this.settings=t,this.state={},t.accessControl&&this.setAccessControl(t.accessControl)}return t.prototype.setAccessControl=function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e],o=r[0],i=Z(r[1]),s=k(i);this.register(o,s,i)}},t.prototype.register=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n={}),this.validateRole(t),this.state[t]={parent:e};for(var r=0,o=Object.entries(n);r<o.length;r++){var i=o[r],s=i[1];this.allow(t,i[0],R("string"==typeof s?[s]:s))}},t.prototype.allow=function(t,e,n){this.validateRole(t),this.getRole(t)||this.register(t,null,{}),n="string"==typeof n?[n]:n;var r=R(this.getRoleResources(t,e));r=r.concat(n),this.state[t][e]=r.filter(function(t,e){return r.indexOf(t)===e})},t.prototype.can=function(t,e,n){return this.validateResource(n),this.getRoleParent(t)&&this.can(this.getRoleParent(t),e,n)||this.exactCan(t,e,n)},t.prototype.getRole=function(t){return this.state[t]},t.prototype.validateRole=function(t){if(!t)throw new Error("NbAclService: role name cannot be empty")},t.prototype.validateResource=function(e){if(!e||[t.ANY_RESOURCE].includes(e))throw new Error("NbAclService: cannot use empty or bulk '*' resource placeholder with 'can' method")},t.prototype.exactCan=function(e,n,r){var o=this.getRoleResources(e,n);return o.includes(r)||o.includes(t.ANY_RESOURCE)},t.prototype.getRoleResources=function(t,e){return this.getRoleAbilities(t)[e]||[]},t.prototype.getRoleAbilities=function(t){var e=Z(this.state[t]||{});return k(Z(this.state[t]||{})),e},t.prototype.getRoleParent=function(t){return this.state[t]?this.state[t].parent:null},t.ANY_RESOURCE="*",t.\u0275fac=function(e){return new(e||t)(h.LFG(A,8))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t}(),T=n(79996),q=function(){function t(t,e){this.roleProvider=t,this.acl=e}return t.prototype.isGranted=function(t,e){var n=this;return this.roleProvider.getRole().pipe((0,T.U)(function(t){return Array.isArray(t)?t:[t]}),(0,T.U)(function(r){return r.some(function(r){return n.acl.can(r,t,e)})}))},t.\u0275fac=function(e){return new(e||t)(h.LFG(w),h.LFG(C))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t}(),S=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:A,useValue:e},C,q]}},t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[r.ez]]}),t}(),O=n(63260),Y=function(){function t(){}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h.Xpm({type:t,selectors:[["nb-playground-auth"]],decls:1,vars:0,template:function(t,e){1&t&&h._UZ(0,"router-outlet")},directives:[O.lC],encapsulation:2}),t}(),_=n(30258),P=n(62657),G=n(47401),U=n(13585),F=n(89514),N=n(91268),E=n(37010),I=n(96843),V=n(25416),j=n(55959),z=function(){function t(t,e,n){this.templateRef=t,this.viewContainer=e,this.accessChecker=n,this.destroy$=new j.xQ,this.hasView=!1}return Object.defineProperty(t.prototype,"nbIsGranted",{set:function(t){var e=this;this.accessChecker.isGranted(t[0],t[1]).pipe((0,V.R)(this.destroy$)).subscribe(function(t){t&&!e.hasView?(e.viewContainer.createEmbeddedView(e.templateRef),e.hasView=!0):!t&&e.hasView&&(e.viewContainer.clear(),e.hasView=!1)})},enumerable:!1,configurable:!0}),t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},t.\u0275fac=function(e){return new(e||t)(h.Y36(h.Rgc),h.Y36(h.s_b),h.Y36(q))},t.\u0275dir=h.lG2({type:t,selectors:[["","nbIsGranted",""]],inputs:{nbIsGranted:"nbIsGranted"}}),t}();function L(t,e){1&t&&(h.TgZ(0,"button"),h._uU(1,"Post Comment"),h.qZA())}function x(t,e){1&t&&(h.TgZ(0,"button"),h._uU(1,"Post Comment"),h.qZA())}var J=function(){return["create","comments"]},B=function(){function t(t){this.accessChecker=t}return t.\u0275fac=function(e){return new(e||t)(h.Y36(q))},t.\u0275cmp=h.Xpm({type:t,selectors:[["nb-actions-test"]],decls:13,vars:5,consts:[[4,"ngIf"],[4,"nbIsGranted"]],template:function(t,e){1&t&&(h.TgZ(0,"nb-layout"),h.TgZ(1,"nb-layout-column"),h.TgZ(2,"nb-card"),h.TgZ(3,"nb-card-header"),h._uU(4,"Service usage"),h.qZA(),h.TgZ(5,"nb-card-body"),h.YNc(6,L,2,0,"button",0),h.ALo(7,"async"),h.qZA(),h.qZA(),h.TgZ(8,"nb-card"),h.TgZ(9,"nb-card-header"),h._uU(10,"Directive usage"),h.qZA(),h.TgZ(11,"nb-card-body"),h.YNc(12,x,2,0,"button",1),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(6),h.Q6J("ngIf",h.lcZ(7,2,e.accessChecker.isGranted("create","comments"))),h.xp6(6),h.Q6J("nbIsGranted",h.DdM(4,J)))},directives:[E.Aq,E.dP,I.As,I.nd,I.yK,r.O5,z],pipes:[r.Ov],encapsulation:2}),t}(),D=n(66599),$=function(){function t(t,e){this.authService=t,this.router=e}return t.prototype.canActivate=function(){var t=this;return this.authService.isAuthenticated().pipe((0,D.b)(function(e){e||t.router.navigate(["auth/login"])}))},t.\u0275fac=function(e){return new(e||t)(h.LFG(l._),h.LFG(O.F0))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t}(),Q=n(40878),K=n(82628),M=n(47727),H=n(30843),W=n(47931);function X(t,e){if(1&t&&(h.TgZ(0,"nb-list-item"),h._uU(1),h.qZA()),2&t){var n=e.$implicit;h.xp6(1),h.lnq(" ",n.region,", ",n.name," (",n.year,") ")}}function tt(t,e){if(1&t&&(h.TgZ(0,"nb-card"),h.TgZ(1,"nb-card-header"),h._uU(2," Alain'wines "),h.qZA(),h.TgZ(3,"nb-list"),h.YNc(4,X,2,3,"nb-list-item",2),h.ALo(5,"async"),h.qZA(),h.qZA()),2&t){var n=h.oxw();h.xp6(4),h.Q6J("ngForOf",h.lcZ(5,1,n.wines$))}}var et=[{path:"",component:Y,children:[{path:"",component:_.A,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:P.Y},{path:"register",component:G.e},{path:"logout",component:U.f},{path:"request-password",component:F.C},{path:"reset-password",component:N.j}]}]},{path:"acl/acl-test.component",component:B},{path:"auth-guard.service",canActivate:[$],component:Y},{path:"api-calls.component",canActivate:[$],component:function(){function t(t,e,n,r){var o=this;void 0===r&&(r={}),this.authService=t,this.http=e,this.router=n,this.options=r,this.redirectDelay=0,this.strategy="",this.redirectDelay=this.getConfigValue("forms.logout.redirectDelay"),this.strategy=this.getConfigValue("forms.logout.strategy"),this.authService.onTokenChange().subscribe(function(t){o.token=null,t&&t.isValid()&&(o.token=t)})}return t.prototype.logout=function(){var t=this;this.authService.logout(this.strategy).pipe((0,K.g)(this.redirectDelay)).subscribe(function(e){return t.router.navigate(["/auth/login"])})},t.prototype.loadWines=function(){var t=this;this.wines$=this.http.get("http://localhost:4400/api/wines").pipe((0,M.K)(function(e){return e instanceof i.UA&&401===e.status&&t.router.navigate(["/auth/login"]),(0,Q.of)([])}))},t.prototype.getConfigValue=function(t){return(0,H.hB)(this.options,t,null)},t.\u0275fac=function(e){return new(e||t)(h.Y36(l._),h.Y36(i.eN),h.Y36(O.F0),h.Y36(p.h))},t.\u0275cmp=h.Xpm({type:t,selectors:[["nb-playground-api-calls"]],decls:15,vars:3,consts:[["nbButton","","status","primary",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,e){var n;1&t&&(h._UZ(0,"router-outlet"),h.TgZ(1,"nb-layout"),h.TgZ(2,"nb-layout-column"),h.TgZ(3,"nb-card"),h.TgZ(4,"nb-card-body"),h.TgZ(5,"h2"),h._uU(6,"You are authenticated"),h.qZA(),h.TgZ(7,"p"),h._uU(8,"You can call the secured API"),h.qZA(),h.TgZ(9,"button",0),h.NdJ("click",function(){return e.loadWines()}),h._uU(10,"Call API"),h.qZA(),h.TgZ(11,"button",0),h.NdJ("click",function(){return e.logout()}),h._uU(12,"Sign out"),h.qZA(),h.qZA(),h.qZA(),h.YNc(13,tt,6,3,"nb-card",1),h.ALo(14,"async"),h.qZA(),h.qZA()),2&t&&(h.xp6(13),h.Q6J("ngIf",null==(n=h.lcZ(14,1,e.wines$))?null:n.length))},directives:[O.lC,E.Aq,E.dP,I.As,I.yK,r.O5,I.nd,W.z,r.sg,W.q],pipes:[r.Ov],encapsulation:2}),t}()}],nt=function(){function t(){}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[O.Bz.forChild(et)],O.Bz]}),t}(),rt=function(){function t(t){this.authService=t}return t.prototype.getRole=function(){return this.authService.onTokenChange().pipe((0,T.U)(function(t){return t instanceof y.OS&&t.isValid()?t.getPayload().role:"guest"}))},t.\u0275fac=function(e){return new(e||t)(h.LFG(l._))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t}();function ot(t){return["http://localhost:4400/api/auth/","http://other.url/with/no/token/injected/"].some(function(e){return t.url.includes(e)})}var it=function(){function t(){}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({providers:[$,{provide:i.TP,useClass:f,multi:!0},{provide:p.nN,useValue:ot},{provide:w,useClass:rt}],imports:[[r.ez,o.u5,i.JF,nt,s.z,c.B,a.C,d.S.forRoot({forms:{login:{strategy:"password",redirectDelay:1e3,socialLinks:[{url:"https://github.com/akveo",target:"_blank",title:"GitHub"},{url:"https://www.facebook.com/akveo",target:"_blank",icon:"home-outline"},{url:"https://www.facebook.com/akveo",target:"_blank",title:"Twitter"}]}},strategies:[g.r.setup({name:"dummy",alwaysFail:!0,delay:1e3}),v.O.setup({name:"email",token:{class:y.OS},baseEndpoint:"http://localhost:4400/api/auth/",logout:{redirect:{success:"/auth/login",failure:"/auth/login"}},requestPass:{redirect:{success:"/auth/reset-password"}},resetPass:{redirect:{success:"/auth/login"}},errors:{key:"data.errors"}}),b.F.setup({name:"password",clientId:"test",clientSecret:"secret",baseEndpoint:"http://localhost:4400/api/auth/",token:{endpoint:"token",grantType:m.sY.PASSWORD,class:y.FN},refresh:{endpoint:"refresh-token",grantType:m.sY.REFRESH_TOKEN}})]}),S.forRoot({accessControl:{guest:{view:["news","comments"]},user:{parent:"guest",create:"comments"},moderator:{parent:"user",create:"news",remove:"*"}}})]]}),t}()}}]);